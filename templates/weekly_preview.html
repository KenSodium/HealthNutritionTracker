<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Weekly Clinician Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Page look */
    body { background:#f7fbff; }
    .report-wrap { max-width: 960px; margin: 24px auto; }
    .card-like { background:#fff; border:1px solid #e6ecf1; border-radius:12px; box-shadow:0 8px 18px rgba(0,0,0,.05); }
    .small-muted { color:#6c7a86; }

    /* Print-friendly */
    @media print {
      .no-print { display:none !important; }
      body { background:#fff; }
      .report-wrap { margin:0; max-width:none; }
      .card-like { border:none; box-shadow:none; }
      a[href]:after { content:""; } /* avoid printing URLs */
    }

    .table thead th { background:#f1f5f9; }
    .status-badge { font-weight:600; }
  </style>
</head>
<body>

<div class="report-wrap">
  <div class="d-flex align-items-center justify-content-between mb-3 no-print">
    <div>
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('reports.history') }}">← Back to History</a>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-dark btn-sm" href="{{ url_for('home') }}">Home</a>
      <button class="btn btn-primary btn-sm" onclick="window.print()">Print / Save as PDF</button>
    </div>
  </div>

  <div class="card-like p-4">
    <div class="d-flex justify-content-between flex-wrap">
      <div>
        <h3 class="mb-1">CKD Weekly Summary (Preview)</h3>
        <div class="small-muted">
          Patient: <strong>{{ patient_name or 'Demo Patient' }}</strong><br>
          Period: <strong>{{ meta.from or '' }}</strong> – <strong>{{ meta.to or '' }}</strong>
          {% if meta.days %} ({{ meta.days }} day{{ 's' if meta.days != 1 else '' }} logged){% endif %}
        </div>
      </div>
      <div class="text-end small-muted">
        <div>Generated: {{ (meta.to or meta.from or '') }}</div>
        <div>Powered by USDA FoodData Central</div>
      </div>
    </div>

    <hr class="my-3">

    {% if meta.days and meta.days > 0 %}

      <!-- FEATURED: with target + status -->
      <h5 class="mt-2">Key Nutrients</h5>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Nutrient</th>
              <th class="text-center">Daily Target</th>
              <th class="text-end">Avg Intake</th>
              <th class="text-center">Range (Min–Max)</th>
              <th class="text-center">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for r in featured_rows %}
            <tr>
              <td>{{ r.name }}</td>
              <td class="text-center">{{ r.target }} {{ r.unit }}</td>
              <td class="text-end">{{ r.avg }} {{ r.unit }}</td>
              <td class="text-center">{{ r.range }} {{ r.unit }}</td>
              <td class="text-center">
                <span class="status-badge {{ r.status_cls }}">{{ r.status_text }}</span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- SUPPLEMENTAL: compact table -->
      <h5 class="mt-4">Supplemental Nutrients (Averages & Ranges)</h5>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Nutrient</th>
              <th class="text-end">Avg</th>
              <th class="text-center">Min–Max</th>
            </tr>
          </thead>
          <tbody>
            {% for r in supplemental_rows %}
            <tr>
              <td>{{ r.name }}</td>
              <td class="text-end">{{ r.avg }} {{ r.unit }}</td>
              <td class="text-center">{{ r.min }}–{{ r.max }} {{ r.unit }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Notes -->
      <h6 class="mt-4">Auto Notes</h6>
      {% if notes and notes|length %}
        <ul class="mb-0">
          {% for n in notes %}<li>{{ n }}</li>{% endfor %}
        </ul>
      {% else %}
        <p class="small text-muted mb-0">No specific concerns detected this week.</p>
      {% endif %}

    {% else %}
      <div class="alert alert-info mb-0 mt-2">
        No data found for the last 7 days. Log a few days in the Daily Diary, then return here.
      </div>
    {% endif %}
  </div>
</div>

</body>
</html>
